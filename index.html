<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Tasks Panel</title>
    <style>
        /* CSS ‡¶ï‡ßã‡¶° ‡¶Ü‡¶ó‡ßá‡¶∞ ‡¶Æ‡¶§‡ßã‡¶á ‡¶•‡¶æ‡¶ï‡¶¨‡ßá, ‡¶è‡¶ñ‡¶æ‡¶®‡ßá ‡¶™‡ßá‡¶∏‡ßç‡¶ü ‡¶ï‡¶∞‡¶æ‡¶∞ ‡¶™‡ßç‡¶∞‡ßü‡ßã‡¶ú‡¶® ‡¶®‡ßá‡¶á */
        @import url('https://fonts.googleapis.com/css2?family=Roboto:wght@400;500;700&display=swap');
        :root {
            --primary-bg: #1c1c1e;
            --secondary-bg: #2c2c2e;
            --text-primary: #ffffff;
            --text-secondary: #8e8e93;
            --accent-yellow: #ffcc00;
            --accent-green: #34c759;
            --accent-purple: #af52de;
            --disabled-color: #555;
        }
        body {
            font-family: 'Roboto', sans-serif;
            background-color: var(--primary-bg);
            color: var(--text-primary);
            margin: 0;
            padding: 15px 15px 80px 15px; /* Add padding for footer */
            -webkit-font-smoothing: antialiased;
            -moz-osx-font-smoothing: grayscale;
        }
        .header {
            text-align: center;
            margin-bottom: 20px;
        }
        .header h1 {
            margin: 0;
            font-size: 24px;
        }
        .header p {
            margin: 5px 0 0;
            color: var(--text-secondary);
            font-size: 16px;
        }
        .task-section h2 {
            font-size: 18px;
            color: var(--text-secondary);
            text-transform: uppercase;
            letter-spacing: 1px;
            margin-bottom: 15px;
        }
        .task-card {
            display: flex;
            align-items: center;
            background-color: var(--secondary-bg);
            padding: 15px;
            border-radius: 12px;
            margin-bottom: 12px;
            transition: transform 0.2s ease, background-color 0.2s ease;
        }
        .task-card:active {
            transform: scale(0.98);
        }
        .task-icon {
            font-size: 32px;
            margin-right: 15px;
        }
        .task-details {
            flex-grow: 1;
        }
        .task-details h3 {
            margin: 0;
            font-size: 16px;
            font-weight: 500;
        }
        .task-details p {
            margin: 4px 0 0;
            font-size: 14px;
            color: var(--text-secondary);
        }
        .claim-button, .timer-display {
            padding: 10px 20px;
            border: none;
            border-radius: 20px;
            font-size: 14px;
            font-weight: 700;
            cursor: pointer;
            transition: background-color 0.2s ease;
            color: var(--primary-bg);
            min-width: 90px;
            text-align: center;
        }
        .claim-button {
            background-color: var(--accent-yellow);
        }
        .claim-button:hover {
            opacity: 0.9;
        }
        .claim-button:disabled {
            background-color: var(--disabled-color);
            color: var(--text-secondary);
            cursor: not-allowed;
        }
        #daily-task .timer-display {
            background-color: var(--accent-purple);
            color: var(--text-primary);
        }
        /* Footer Navigation */
        .footer-nav {
            position: fixed;
            bottom: 0;
            left: 0;
            right: 0;
            display: flex;
            justify-content: space-around;
            background-color: var(--secondary-bg);
            padding: 10px 0;
            border-top: 1px solid #3a3a3c;
        }
        .nav-button {
            background: none;
            border: none;
            color: var(--text-secondary);
            cursor: pointer;
            display: flex;
            flex-direction: column;
            align-items: center;
            font-size: 12px;
        }
        .nav-button.active {
            color: var(--accent-yellow);
        }
        .nav-button svg {
            width: 24px;
            height: 24px;
            margin-bottom: 4px;
        }
    </style>
</head>
<body>

    <div class="header">
        <h1>Welcome, <span id="username">User</span></h1>
        <p>Your Balance: $<span id="balance">0.00</span></p>
    </div>

    <div class="task-section" id="tasks">
        <h2>Tasks <span id="ad-limit-info"></span></h2>
        
        <div class="task-card">
            <div class="task-icon">üåü</div>
            <div class="task-details">
                <h3>Watch short ads</h3>
                <p>Rewarded Interstitial</p>
            </div>
            <button class="claim-button" id="task1-claim">Claim</button>
        </div>

        <div class="task-card">
            <div class="task-icon">üòé</div>
            <div class="task-details">
                <h3>Click to get reward</h3>
                <p>Rewarded Popup</p>
            </div>
            <button class="claim-button" id="task2-claim">Claim</button>
        </div>
    </div>

    <div class="task-section" id="daily-tasks">
        <h2>Daily</h2>
        
        <div class="task-card" id="daily-task">
            <div class="task-icon">üëÄ</div>
            <div class="task-details">
                <h3>Watch video</h3>
                <p>In-App Interstitial</p>
            </div>
            <div class="timer-display" id="daily-timer">Claim</div>
        </div>
    </div>

    <footer class="footer-nav">
        <button class="nav-button active" onclick="alert('Home page')">
            <svg fill="currentColor" viewBox="0 0 20 20"><path d="M10.707 2.293a1 1 0 00-1.414 0l-7 7a1 1 0 001.414 1.414L4 10.414V17a1 1 0 001 1h2a1 1 0 001-1v-2a1 1 0 011-1h2a1 1 0 011 1v2a1 1 0 001 1h2a1 1 0 001-1v-6.586l.293.293a1 1 0 001.414-1.414l-7-7z"></path></svg>
            <span>Home</span>
        </button>
        <button class="nav-button" onclick="alert('Earn page (You are here)')">
             <svg fill="currentColor" viewBox="0 0 20 20"><path fill-rule="evenodd" d="M4 4a2 2 0 00-2 2v4a2 2 0 002 2h12a2 2 0 002-2V6a2 2 0 00-2-2H4zm0 10a2 2 0 00-2 2v4a2 2 0 002 2h12a2 2 0 002-2v-4a2 2 0 00-2-2H4z" clip-rule="evenodd"></path></svg>
            <span>Earn</span>
        </button>
        <button class="nav-button" onclick="alert('Withdraw page')">
             <svg fill="currentColor" viewBox="0 0 20 20"><path d="M4 4a2 2 0 00-2 2v1h16V6a2 2 0 00-2-2H4z"></path><path fill-rule="evenodd" d="M18 9H2v5a2 2 0 002 2h12a2 2 0 002-2V9zM4 13a1 1 0 011-1h1a1 1 0 110 2H5a1 1 0 01-1-1zm5-1a1 1 0 100 2h1a1 1 0 100-2H9z" clip-rule="evenodd"></path></svg>
            <span>Withdraw</span>
        </button>
        <button class="nav-button" onclick="alert('Profile page')">
            <svg fill="currentColor" viewBox="0 0 20 20"><path fill-rule="evenodd" d="M10 9a3 3 0 100-6 3 3 0 000 6zm-7 9a7 7 0 1114 0H3z" clip-rule="evenodd"></path></svg>
            <span>Profile</span>
        </button>
    </footer>

    <script src="https://www.gstatic.com/firebasejs/9.6.1/firebase-app-compat.js"></script>
    <script src="https://www.gstatic.com/firebasejs/9.6.1/firebase-database-compat.js"></script>
    <script src="https://telegram.org/js/telegram-web-app.js"></script>
    <script>
        // Ad function callers. These will dynamically call the ad network's functions.
        // For example, if zone ID is 12345, it will call window['show_12345']().
        // This is a placeholder; your real ad SDK must be included in your project.
        function callAdFunction(zoneId, params) {
            const functionName = `show_${zoneId}`;
            if (typeof window[functionName] === 'function') {
                console.log(`Calling ad function: ${functionName} with params:`, params);
                 // Simulate an ad watch promise
                return new Promise((resolve, reject) => {
                    alert(`Simulating ad for Zone ID: ${zoneId}. Click OK to get reward.`);
                    resolve();
                });
                // In production, you would use this line:
                // return window[functionName](params);
            } else {
                console.error(`Ad function ${functionName} not found.`);
                return Promise.reject(`Ad function ${functionName} not found.`);
            }
        }
    </script>
    
    <script>
        document.addEventListener('DOMContentLoaded', () => {
            const firebaseConfig = {
                apiKey: "AIzaSyB6v9Y1vFMdno6FX4KDOsQdj1OnZA6D8yc",
                authDomain: "hard-bf03f.firebaseapp.com",
                databaseURL: "https://hard-bf03f-default-rtdb.firebaseio.com",
                projectId: "hard-bf03f",
                storageBucket: "hard-bf03f.appspot.com",
                messagingSenderId: "1015192916839",
                appId: "1:1015192916839:web:b21656bd678339bb9115c2",
                measurementId: "G-XKCZ1VW9DP"
            };

            firebase.initializeApp(firebaseConfig);
            const database = firebase.database();
            const tg = window.Telegram.WebApp;
            tg.expand();

            if (!tg.initDataUnsafe.user) {
                document.body.innerHTML = '<h1>Please open this in your Telegram app.</h1>';
                return;
            }

            const userId = tg.initDataUnsafe.user.id;
            const username = tg.initDataUnsafe.user.first_name;

            const balanceEl = document.getElementById('balance');
            const usernameEl = document.getElementById('username');
            const task1Btn = document.getElementById('task1-claim');
            const task2Btn = document.getElementById('task2-claim');
            const dailyTimerEl = document.getElementById('daily-timer');
            const adLimitInfoEl = document.getElementById('ad-limit-info');
            
            let config = {};
            let user = {};
            let dailyTaskInterval;

            async function initializeApp() {
                usernameEl.textContent = username;

                const configRef = database.ref('config');
                configRef.on('value', (snapshot) => {
                    config = snapshot.val();
                    if(!config || !config.zone_id){
                        document.body.innerHTML = "<h1>Configuration Error</h1><p>Admin has not set the Zone ID yet.</p>";
                    }
                    updateUI();
                });

                const userRef = database.ref('users/' + userId);
                userRef.on('value', (snapshot) => {
                    if (snapshot.exists()) {
                        user = snapshot.val();
                    } else {
                        user = {
                            username: username, balance: 0, ads_watched_today: 0,
                            last_ad_watched_timestamp: 0, daily_task_last_claim: 0
                        };
                        userRef.set(user);
                    }
                    updateUI();
                });
            }

            function updateUI() {
                if (!config || !user) return;
                balanceEl.textContent = parseFloat(user.balance || 0).toFixed(4);
                const adsWatched = user.ads_watched_today || 0;
                const adLimit = config.ads_limit_per_day || 10;
                adLimitInfoEl.textContent = `(${adsWatched}/${adLimit})`;
                
                const limitReached = adsWatched >= adLimit;
                task1Btn.disabled = limitReached;
                task1Btn.textContent = limitReached ? "Limit Reached" : "Claim";
                task2Btn.disabled = limitReached;
                task2Btn.textContent = limitReached ? "Limit Reached" : "Claim";

                if (dailyTaskInterval) clearInterval(dailyTaskInterval);
                const cooldown = (config.dailyTask_cooldown_hours || 24) * 3600000;
                const nextClaimTime = (user.daily_task_last_claim || 0) + cooldown;
                
                dailyTaskInterval = setInterval(() => {
                    const timeLeft = nextClaimTime - Date.now();
                    if (timeLeft <= 0) {
                        dailyTimerEl.textContent = 'Claim';
                        dailyTimerEl.style.cursor = 'pointer';
                        dailyTimerEl.onclick = claimDailyTask;
                        clearInterval(dailyTaskInterval);
                    } else {
                        const hours = Math.floor((timeLeft / 3600000) % 24);
                        const minutes = Math.floor((timeLeft / 60000) % 60);
                        const seconds = Math.floor((timeLeft / 1000) % 60);
                        dailyTimerEl.textContent = `${String(hours).padStart(2, '0')}:${String(minutes).padStart(2, '0')}:${String(seconds).padStart(2, '0')}`;
                        dailyTimerEl.style.cursor = 'not-allowed';
                        dailyTimerEl.onclick = null;
                    }
                }, 1000);
            }

            async function handleTask(taskType, rewardAmount) {
                if ((user.ads_watched_today || 0) >= config.ads_limit_per_day) {
                    tg.showAlert('You have reached your daily ad limit.');
                    return;
                }

                try {
                    let adPromise;
                    if (taskType === 1) adPromise = callAdFunction(config.zone_id);
                    if (taskType === 2) adPromise = callAdFunction(config.zone_id, 'pop');
                    
                    await adPromise;
                    
                    const newBalance = (user.balance || 0) + rewardAmount;
                    await database.ref().update({
                        [`/users/${userId}/balance`]: newBalance,
                        [`/users/${userId}/ads_watched_today`]: (user.ads_watched_today || 0) + 1,
                        [`/users/${userId}/last_ad_watched_timestamp`]: firebase.database.ServerValue.TIMESTAMP
                    });
                    
                    tg.HapticFeedback.notificationOccurred('success');
                    tg.showAlert(`Congratulations! You've earned $${rewardAmount.toFixed(4)}.`);
                } catch (e) {
                    tg.HapticFeedback.notificationOccurred('error');
                    tg.showAlert('Ad could not be loaded. Please try again later.');
                    console.error('Ad error:', e);
                }
            }

            async function claimDailyTask() {
                 const cooldown = (config.dailyTask_cooldown_hours || 24) * 3600000;
                if (Date.now() < (user.daily_task_last_claim || 0) + cooldown) {
                    tg.showAlert('Daily task is not available yet.');
                    return;
                }
                
                try {
                    const inAppParams = {
                        type: 'inApp',
                        inAppSettings: { frequency: 2, capping: 0.1, interval: 30, timeout: 5, everyPage: false }
                    };
                    await callAdFunction(config.zone_id, inAppParams);

                    const rewardAmount = config.dailyTask_reward || 0.05;
                    const newBalance = (user.balance || 0) + rewardAmount;
                    await database.ref().update({
                        [`/users/${userId}/balance`]: newBalance,
                        [`/users/${userId}/daily_task_last_claim`]: firebase.database.ServerValue.TIMESTAMP
                    });
                    
                    tg.HapticFeedback.notificationOccurred('success');
                    tg.showAlert(`Daily reward claimed! You've earned $${rewardAmount.toFixed(4)}.`);
                } catch (e) {
                    tg.HapticFeedback.notificationOccurred('error');
                    tg.showAlert('An error occurred. Please try again.');
                    console.error('Daily task error:', e);
                }
            }
            
            task1Btn.addEventListener('click', () => handleTask(1, config.task1_reward || 0.01));
            task2Btn.addEventListener('click', () => handleTask(2, config.task2_reward || 0.015));

            initializeApp();
        });
    </script>
</body>
</html>            const usernameEl = document.getElementById('username');
            const task1Btn = document.getElementById('task1-claim');
            const task2Btn = document.getElementById('task2-claim');
            const dailyTimerEl = document.getElementById('daily-timer');
            const adLimitInfoEl = document.getElementById('ad-limit-info');
            
            let config = {};
            let user = {};
            let dailyTaskInterval;

            // Fetch config and user data
            async function initializeApp() {
                usernameEl.textContent = username;

                const configRef = database.ref('config');
                configRef.on('value', (snapshot) => {
                    config = snapshot.val();
                    updateUI();
                });

                const userRef = database.ref('users/' + userId);
                userRef.on('value', (snapshot) => {
                    if (snapshot.exists()) {
                        user = snapshot.val();
                    } else {
                        // Create new user
                        user = {
                            username: username,
                            balance: 0,
                            ads_watched_today: 0,
                            last_ad_watched_timestamp: 0,
                            daily_task_last_claim: 0
                        };
                        userRef.set(user);
                    }
                    updateUI();
                });
            }

            function updateUI() {
                if (!config || !user) return;

                // Update balance
                balanceEl.textContent = parseFloat(user.balance || 0).toFixed(4);

                // Check daily ad limit
                const adsWatched = user.ads_watched_today || 0;
                const adLimit = config.ads_limit_per_day || 10;
                adLimitInfoEl.textContent = `(${adsWatched}/${adLimit})`;
                
                if (adsWatched >= adLimit) {
                    task1Btn.disabled = true;
                    task1Btn.textContent = "Limit Reached";
                    task2Btn.disabled = true;
                    task2Btn.textContent = "Limit Reached";
                } else {
                    task1Btn.disabled = false;
                    task1Btn.textContent = "Claim";
                    task2Btn.disabled = false;
                    task2Btn.textContent = "Claim";
                }

                // Handle daily task timer
                if (dailyTaskInterval) clearInterval(dailyTaskInterval);
                const cooldown = (config.dailyTask_cooldown_hours || 24) * 60 * 60 * 1000;
                const lastClaim = user.daily_task_last_claim || 0;
                const nextClaimTime = lastClaim + cooldown;

                dailyTaskInterval = setInterval(() => {
                    const now = Date.now();
                    const timeLeft = nextClaimTime - now;

                    if (timeLeft <= 0) {
                        dailyTimerEl.textContent = 'Claim';
                        dailyTimerEl.style.cursor = 'pointer';
                        dailyTimerEl.onclick = claimDailyTask;
                        clearInterval(dailyTaskInterval);
                    } else {
                        const hours = Math.floor((timeLeft / (1000 * 60 * 60)) % 24);
                        const minutes = Math.floor((timeLeft / 1000 / 60) % 60);
                        const seconds = Math.floor((timeLeft / 1000) % 60);
                        dailyTimerEl.textContent = `${String(hours).padStart(2, '0')}:${String(minutes).padStart(2, '0')}:${String(seconds).padStart(2, '0')}`;
                        dailyTimerEl.style.cursor = 'not-allowed';
                        dailyTimerEl.onclick = null;
                    }
                }, 1000);
            }

            async function handleTask(taskType, rewardAmount) {
                const adsWatched = user.ads_watched_today || 0;
                if (adsWatched >= config.ads_limit_per_day) {
                    tg.showAlert('You have reached your daily ad limit.');
                    return;
                }

                try {
                    let adPromise;
                    if (taskType === 1) adPromise = show_9700198();
                    if (taskType === 2) adPromise = show_9700198('pop');

                    await adPromise;
                    
                    const newBalance = (user.balance || 0) + rewardAmount;
                    const updates = {
                        [`/users/${userId}/balance`]: newBalance,
                        [`/users/${userId}/ads_watched_today`]: (user.ads_watched_today || 0) + 1,
                        [`/users/${userId}/last_ad_watched_timestamp`]: firebase.database.ServerValue.TIMESTAMP
                    };
                    await database.ref().update(updates);
                    
                    tg.HapticFeedback.notificationOccurred('success');
                    tg.showAlert(`Congratulations! You've earned $${rewardAmount.toFixed(4)}.`);
                } catch (e) {
                    tg.HapticFeedback.notificationOccurred('error');
                    tg.showAlert('Ad could not be loaded. Please try again later.');
                    console.error('Ad error:', e);
                }
            }

            async function claimDailyTask() {
                const cooldown = (config.dailyTask_cooldown_hours || 24) * 60 * 60 * 1000;
                if (Date.now() < (user.daily_task_last_claim || 0) + cooldown) {
                    tg.showAlert('Daily task is not available yet.');
                    return;
                }

                try {
                    // This task type does not return a promise in your example
                    // We assume it's a "fire and forget" call
                     show_9700198({
                        type: 'inApp',
                        inAppSettings: { frequency: 2, capping: 0.1, interval: 30, timeout: 5, everyPage: false }
                    });

                    // We will reward the user immediately
                    const rewardAmount = config.dailyTask_reward || 0.05;
                    const newBalance = (user.balance || 0) + rewardAmount;
                    const updates = {
                        [`/users/${userId}/balance`]: newBalance,
                        [`/users/${userId}/daily_task_last_claim`]: firebase.database.ServerValue.TIMESTAMP
                    };
                    await database.ref().update(updates);
                    
                    tg.HapticFeedback.notificationOccurred('success');
                    tg.showAlert(`Daily reward claimed! You've earned $${rewardAmount.toFixed(4)}.`);
                } catch (e) {
                    tg.HapticFeedback.notificationOccurred('error');
                    tg.showAlert('An error occurred. Please try again.');
                    console.error('Daily task error:', e);
                }
            }
            
            task1Btn.addEventListener('click', () => handleTask(1, config.task1_reward || 0.01));
            task2Btn.addEventListener('click', () => handleTask(2, config.task2_reward || 0.015));

            initializeApp();
        });
    </script>
</body>
</html>
